{% extends "base.html" %}

{% block title %}Netflix Local Viewing Activity{% endblock %}

{% block content %}
<link href="{{ url_for('static', filename='css/netflix_dashboard.css') }}" rel="stylesheet">

<div class="container">
    <div class="intro-text">
        <h2>Netflix Viewing Activity (Local Only)</h2>
        <p>
            Explore your Netflix history privately.
            <strong>Your files are processed locally in your browser. We do not upload or store your Netflix
                data.</strong>
            This tool runs entirely on your device.
        </p>
    </div>

    <!-- Upload Section -->
    <div class="upload-section">
        <div class="upload-box">
            <h3>Option 1: Netflix Export ZIP</h3>
            <p>Select the .zip file you downloaded from Netflix.</p>
            <div class="input-group">
                <input type="file" id="zip-input" accept=".zip">
            </div>
        </div>

        <div class="upload-box">
            <h3>Option 2: Folder Upload</h3>
            <p>Select the unzipped folder containing <code>ViewingActivity.csv</code>.</p>
            <div class="input-group">
                <input type="file" id="folder-input" webkitdirectory directory>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="error-message" class="error-message"></div>
    <div id="success-message" class="success-message"></div>
    <div id="loading-spinner" class="loading-spinner">
        <i class="fas fa-spinner fa-spin fa-2x"></i>
        <p>Processing files locally...</p>
    </div>

    <!-- Data Display Section (Hidden initially) -->
    <div id="data-container" style="display: none;">

        <div class="data-summary">
            <h3>Summary</h3>
            <p><strong>Total Rows:</strong> <span id="summary-count">0</span></p>
            <p><strong>Date Range:</strong> <span id="summary-dates">-</span></p>
        </div>

        <div class="actions-bar">
            <input type="text" id="search-input" class="search-box" placeholder="Search by title...">
            <button id="download-btn" class="download-btn" disabled>
                <i class="fas fa-download"></i> Download ViewingActivity.csv
            </button>
        </div>

        <div class="table-container">
            <table id="viewing-activity-table">
                <thead>
                    <tr>
                        <!-- Headers will be injected here -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be injected here -->
                </tbody>
            </table>
        </div>

        <div class="pagination-controls" id="pagination-controls">
            <button id="prev-page" class="pagination-btn">Previous</button>
            <span id="page-info">Page 1</span>
            <button id="next-page" class="pagination-btn">Next</button>
        </div>
    </div>
</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" nonce="{{ csp_nonce }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" nonce="{{ csp_nonce }}"></script>

<!-- Main Logic -->
<script src="{{ url_for('static', filename='js/netflix_dashboard.js') }}" nonce="{{ csp_nonce }}"></script>
{% endblock %}